<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:100,200,300,400,500,600,700,800,900&subset=latin,latin-ext'
        rel='stylesheet' type='text/css'/>
    <link href='https://fonts.googleapis.com/css?family=Noto+Serif:400,700,400italic,700italic'
        rel='stylesheet' type='text/css'/>
    <link href="https://developer.blackboard.com/assets/portal/menu-styles.css" rel='stylesheet' type='text/css' />
    <link href="https://developer.blackboard.com/assets/portal/main-styles.css" rel="stylesheet" type="text/css" />
    <link href="https://developer.blackboard.com/assets/portal/styles_ultra.css" rel="stylesheet" type="text/css" />
    <link href="https://developer.blackboard.com/assets/portal/dev-portal.css" rel="stylesheet" type="text/css" />
    <link href="/assets/css/styles.css" rel="stylesheet" type="text/css" />

    <title></title>
    
    <link rel="shortcut icon" type="image/x-icon" href='https://developer.blackboard.com/assets/portal/favicon.ico'>
    <script>
        /* Set the width of the side navigation to 250px */
        function openNav() {
            document.getElementById("mySidenav").style.width = "500px";
            document.getElementById("main").style.marginLeft = "500px";
            document.body.style.backgroundColor = "rgba(0,0,0,0.4)";
        }

        /* Set the width of the side navigation to 0 */
        function closeNav() {
            document.getElementById("mySidenav").style.width = "0";
            document.getElementById("main").style.marginLeft = "0";
            document.body.style.backgroundColor = "white";
        }
    </script>
    <script>
      /* Loop through all dropdown buttons to toggle between hiding and showing its dropdown content - This allows the user to have multiple dropdowns without any conflict */
      var dropdown = document.getElementsByClassName("dropdown-btn");
      var i;
      
      for (i = 0; i < dropdown.length; i++) {
        dropdown[i].addEventListener("click", function() {
        this.classList.toggle("active");
        var dropdownContent = this.nextElementSibling;
        if (dropdownContent.style.display === "block") {
        dropdownContent.style.display = "none";
        } else {
        dropdownContent.style.display = "block";
        }
        });
      }
    </script>
    <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" />
    <!-- Begin Jekyll SEO tag v2.6.1 -->
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="http://localhost:4000/learn/B2s/Course,%20User,%20and%20Enrollment%20Data.html" />
<meta property="og:url" content="http://localhost:4000/learn/B2s/Course,%20User,%20and%20Enrollment%20Data.html" />
<script type="application/ld+json">
{"@type":"WebPage","url":"http://localhost:4000/learn/B2s/Course,%20User,%20and%20Enrollment%20Data.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>
  <body>
    <div id='top-content'>
    <div id="header" class='header-min-width'>
        <div id="header-logos">
            <div id="header-logos-left-container" class='inline-box'>
                <a id="bb-home-logo-link" href="http://www.blackboard.com" target="_blank"><img class="bb-home-logo-image" src="https://developer.blackboard.com/assets/images/bb_logo_subpages.png" alt="Blackboard"/></a>
            </div>
            <div id="header-logos-right-container" class='inline-box'>
                
                    <a href="Contact.html" class="header-section-link">Contact Us</a>
                
                    <a href="https://community.blackboard.com/developers" class="header-section-link">Community</a>
                
                    <a href="https://developer.blackboard.com" class="header-section-link">Developer Portal</a>
                
                    <a href="BECOME%20AN%20OFFICIAL%20BLACKBOARD%20PARTNER!.html" class="header-section-link">Become a Partner</a>
                
                    <a href="/Get%20Involved.html" class="header-section-link">Get Involved</a>
                
            </div>
            <br class="clearBoth"/>
        </div>
            
        <br />
        <div class="wrap">
            <div id="subhead-section" class="subhead-icon-header-interaction">
                <h1 style="color: white;">Developer Documentation</h1>
            </div>
        </div>
    </div>
</div>
    <nav style='background-color: black;'>
  
    <a href="/" class="header-section-link">Home</a>
  
    <a href="/learn/Integrate%20with%20Blackboard%20Learn.html" class="header-section-link">Learn</a>
  
    <a href="/collab/Getting%20Started%20With%20The%20Blackboard%20Collaborate%20REST%20APIs.html" class="header-section-link">Collab</a>
  
    <a href="/connecttxt/Blackboard%20ConnectTxt%20Developer%20Documentation.html" class="header-section-link">ConnectTxt</a>
  
    <a href="/mobile/Blackboard%20App%20for%20Students%20Launch%20Schema.html" class="header-section-link">Mobile</a>
  
    <a href="/openlms/Blackboard%20Open%20LMS%20Approved%20Plugin%20Program%20(MAP).html" class="header-section-link">OpenLMS</a>
  
    <a href="/dvba/What%20is%20a%20DVBA%3F.html" class="header-section-link">DVBA</a>
  
    <a href="/standards/Welcome%20To%20Standards.html" class="header-section-link">Standards</a>
  
    <a href="/sitemap.html" class="header-section-link">Sitemap</a>
  
    <a href="/search.html" class="header-section-link">Search</a>
  
</nav>
    <section>
      <div id="mySidenav" class="sidenav">
    <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a><br>
    
        <ul>
            
                    <li><a href="/learn/Integrate%20with%20Blackboard%20Learn.html" class="header-section-link" >Learn</a></li>
                    
            
                    <li><a href="/learn/REST/Getting%20Started%20With%20REST.html" class="header-section-link" >REST</a></li>
                    
            
                    <li><a href="/learn/B2s/Getting%20Started%20With%20Building%20Blocks.html" class="header-section-link" >B2s</a></li>
                    
                        <ul>
                            
                                <li><a href="/learn/B2s/Getting%20Started%20With%20Building%20Blocks.html" class="header-section-link" >Getting Started</a></li>
                                
                            
                                <li><a href="/learn/B2s/Blackboard%20Building%20Blocks.html" class="header-section-link" >About</a></li>
                                
                            
                                <li><a href="/learn/B2s/advanced.html" class="header-section-link" >Advanced</a></li>
                                
                            
                                <li><a href="/learn/B2s/Building%20Block%20Resources%20and%20Tools.html" class="header-section-link" >Resources</a></li>
                                
                            
                                <li><a href="/learn/B2s/Preparing%20Your%20Building%20Blocks%20For%20Learn%20SaaS%20and%20Newer%20Learn%20Versions.html" class="header-section-link" >Best Practices</a></li>
                                
                            
                                <li><a href="/learn/B2s/Introduction%20to%20OpenDB.html" class="header-section-link" >OpenDb</a></li>
                                
                            
                                <li><a href="/learn/B2s/Examples%20-%20Building%20Blocks.html" class="header-section-link" >Examples</a></li>
                                
                                    <ul>
                                        
                                            <li><a href="/learn/B2s/Course,%20User,%20and%20Enrollment%20Data.html" class="header-section-link" >Course, Users, Enrollments</a></li>
                                        
                                            <li><a href="/learn/B2s/Spring%20in%20Building%20Blocks.html" class="header-section-link" >Spring</a></li>
                                        
                                            <li><a href="/learn/B2s/Tutorial%20-%20Schema%20XML.html" class="header-section-link" >Schema</a></li>
                                        
                                    </ul>
                                
                            
                        </ul>
                
            
                    <li><a href="/learn/SOAP%20-%20Deprecated/SOAP-to-REST%20Migration%20Mapping.html" class="header-section-link" >SOAP - Deprecated</a></li>
                    
            
        </ul>
    
        
</div>
      
<!-- Add all page content inside this div if you want the side nav to push page content to the right (not used if you only want the sidenav to sit on top of the page -->
<div id="main">
    <!-- Use any element to open the sidenav -->
    <span style="font-size:30px;cursor:pointer" onclick="openNav()">&#9776;</span>

    <h1 id="course-user-and-enrollment-data">Course, User, and Enrollment Data</h1>
<p><em>Author: Kelley MacEwen</em><br />
<em>Categories: [‘Building Blocks’, ‘Examples’]</em><br />
<em>Tags: [‘tutorial’, ‘tutorials’, ‘blackboard learn’, ‘developers’, ‘migrated from edugarage’, ‘developer’]</em></p>
<hr />

<p>This tutorial will show you how to retrieve and save user information using
various methods throughout the user interface.</p>

<h1 id="loading-user-information-from-the-context">Loading user information from the context</h1>

<p>A new utility API was added in version 7.2 that allows even easier access to
the Blackboard context from inside your Building Block. It is located in
blackboard.platform.context.ContextManagerFactory.</p>

<p>An example of how to use this API to load user information follows:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//initializes context

ContextManagerFactory.getInstance().setContext(request);

//retrieves the users first name, you can get any parameter from
blackboard.data.user.User from the getUser() method.

String firstName =
ContextManagerFactory.getInstance().getContext().getUser().getGivenName();
</code></pre></div></div>

<h1 id="loading-user-information-by-using-the-usersearch-api">Loading user information by using the UserSearch API</h1>

<p>The UserSearch API located in blackboard.persist.user.UserSearch can be used
to search for specific users that exist within Blackboard.</p>

<p>An example of how to use this API follows:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//Creates and initializes a new user search

UserSearch us = UserSearch.getNameSearch( UserSearch.SearchKey.UserName,
SearchOperator.Equals, "administrator" );

//Gets a list of users who match (note: the above search will only return one
user)

List users = UserDbLoader.Default.getInstance().loadByUserSearch(us);

//Iterate through users
</code></pre></div></div>

<p>Search keys exist to search by name, e-mail, system role, username, and
enrollment count. Search operators exist for search methods including equals,
contains, like, greater than, less than, is null, starts with, and others.
These are documented in the API Javadocs located in the Documentation section
of this web site.</p>

<h1 id="getting-a-role">Getting a role</h1>

<p>To retrieve a persons role within a course, simply use the following code:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CourseMembership existing = null;

try {
  existing = CourseMembershipDbLoader.Default.getInstance().loadByCourseAndUserId(courseCode, personCode);
} catch (KeyNotFoundException e) {

} catch (PersistenceException e) {
  log.severe("BlackboardRole.add: Check on role for " + courseCode + " " + personCode + " failed. " + e.getMessage());

}
</code></pre></div></div>

<h1 id="adding-roles">Adding Roles</h1>

<h2 id="allocation-of-a-role">Allocation of a role</h2>

<p>Here is a basic example that will get you going. It is all you need. You can
use this code to associate any person with any subject with any role.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CourseMembership newRole = new CourseMembership();

/* Specify which role to allocate */

newRole.setRole(CourseMembership.Role.STUDENT);

/* You could also use one of these:
  newRole.setRole(CourseMembership.Role.INSTRUCTOR);
  newRole.setRole(CourseMembership.Role.GRADER);
  newRole.setRole(CourseMembership.Role.COURSE_BUILDER);
  newRole.setRole(CourseMembership.Role.TEACHING_ASSISTANT);
*/

/* Specify the course batch uid, and person batch uid */

newRole.setCourseId("JACOB101");

newRole.setUserId("jrhoden");

/* Now simply persist the role to the database */

try {
  CourseMembershipDbPersister.Default.getInstance().persist(newRole);
  log.fine("BlackboardRole.add: Success " + role2.subjectCode + " " + role2.username + " " + role2.role);

} catch (Exception e) {

  log.severe("Problem adding role: Failed " + role2.subjectCode + " " + role2.username + " " + role2.role + ". " + e.getMessage());
  return false;
}
</code></pre></div></div>

<p>However this code does not handle very well when there is a problem. For
example you may only insert one role, per person, per course. You probably
want something a bit more sophisticated which first checks for a current role
before inserting.</p>

<h1 id="sophisticated-allocation-of-a-role">Sophisticated allocation of a role</h1>

<p>The following example is what we use for our blackboard server. It attempts to
neatly handle exceptions.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public static boolean add(String courseCode, String personCode, String role) {
  CourseMembership newRole = new CourseMembership();
  
  /* First we set the specified role */
  try {
    if(role.equals("student"))
      newRole.setRole(CourseMembership.Role.STUDENT);
    else if(role.equals("primary_coordinator"))
      newRole.setRole(CourseMembership.Role.INSTRUCTOR);
    else if(role.equals("secondary_coordinator"))
      newRole.setRole(CourseMembership.Role.INSTRUCTOR);
    else if(role.equals("marker"))
      newRole.setRole(CourseMembership.Role.GRADER);
    else if(role.equals("designer"))
      newRole.setRole(CourseMembership.Role.COURSE_BUILDER);
    else if(role.equals("tutor"))
      newRole.setRole(CourseMembership.Role.TEACHING_ASSISTANT);
    else {
      log.fine("BlackboardRole.add: Failed. Invalid role: " + role);
      return false;
    }
  }
  catch(java.lang.IllegalArgumentException e) {
    log.severe("BlackboardRole.add: Failed on course " + courseCode + " adding " + personCode + " as " + role + ". " + e.getMessage());
    return false;
  }

  /* Check that the specified course exists */
  try {
    course = CourseSiteLoader.Default.getInstance().load(courseCode);
  } catch(blackboard.persist.PersistenceException e){
    log.severe("BlackboardRole.add: Could not find course: " + courseCode + " " + e.getMessage());
    return false;
  }

  /* Check the specified person exists */
  try {
    person = PersonLoader.Default.getInstance().load(personCode);
  } catch(blackboard.persist.PersistenceException e){
    log.severe("BlackboardRole.add: Could not find person: " + personCode + " " + e.getMessage());
    return false;
  }

  newRole.setCourseId(course.getId());
  newRole.setUserId(person.getId());

  /* Check if the person already has a role in this course */
  try {
    CourseMembership existing =
      CourseMembershipDbLoader.Default.getInstance().loadByCourseAndUserId(
    course.getId(), person.getId());

    if(existing.getRole()==newRole.getRole()) {
      log.fine("BlackboardRole.add: Silently ignoring message. " + person.getId() + " already has this role in " + course.getId() + ".");
      return true;
    }
    
    log.warning("BlackboardRole.add: Overriding existing role for " + person.getId() + " in " + course.getId() + ".");

    /* Person already has a role in this course, we will update the current role and issue a warning */
    existing.setRole(newRole.getRole());

    try {
      CourseMembershipDbPersister.Default.getInstance().persist(existing);
    } catch (ValidationException e) {
      log.warning("BlackboardRole.add: Overriding existing role for " + person.getId() + " in " + course.getId() + " failed. " + e.getMessage());
      return false;
    }

    return false;

  } catch (KeyNotFoundException e) {

  } catch (PersistenceException e) {
    log.severe("BlackboardRole.add: Check on role for " + courseCode + " " + personCode + " failed. " + e.getMessage());
    return false;
  }

  /* If the person has no role, we now persist the role */
  try {
    CourseMembershipDbPersister.Default.getInstance().persist(newRole);
    log.fine("BlackboardRole.add: Success " + courseCode + " " + personCode + " " + role);
  } catch (Exception e) {
    log.severe("Problem adding role: Failed " + courseCode + " " + personCode + " " + role + ". " + e.getMessage());
    return false;
  }

  return true;
}
</code></pre></div></div>

</div>
    </section>
    <footer>
    <div id="header" class='header-min-width'>
        <div id="header-logos">
            <div id="header-logos-left-container" class='inline-box'>
                <a id="bb-home-logo-link" href="http://www.blackboard.com" target="_blank"><img class="bb-home-logo-image" src="https://developer.blackboard.com/assets/images/bb_logo_subpages.png" alt="Blackboard"/></a>
            </div>
            <div id="header-logos-right-container" class='inline-box'>
                
                    <a href="Contact.html" class="header-section-link">Contact Us</a>
                
                    <a href="https://community.blackboard.com/developers" class="header-section-link">Community</a>
                
                    <a href="https://developer.blackboard.com" class="header-section-link">Developer Portal</a>
                
                    <a href="BECOME%20AN%20OFFICIAL%20BLACKBOARD%20PARTNER!.html" class="header-section-link">Become a Partner</a>
                
                    <a href="/Get%20Involved.html" class="header-section-link">Get Involved</a>
                
            </div>
            <br class="clearBoth"/>
        </div>
    </div>
</footer>
  </body>
</html>