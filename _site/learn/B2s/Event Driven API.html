<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:100,200,300,400,500,600,700,800,900&subset=latin,latin-ext'
        rel='stylesheet' type='text/css'/>
    <link href='https://fonts.googleapis.com/css?family=Noto+Serif:400,700,400italic,700italic'
        rel='stylesheet' type='text/css'/>
    <link href="https://developer.blackboard.com/assets/portal/menu-styles.css" rel='stylesheet' type='text/css' />
    <link href="https://developer.blackboard.com/assets/portal/main-styles.css" rel="stylesheet" type="text/css" />
    <link href="https://developer.blackboard.com/assets/portal/styles_ultra.css" rel="stylesheet" type="text/css" />
    <link href="https://developer.blackboard.com/assets/portal/dev-portal.css" rel="stylesheet" type="text/css" />
    <link href="/assets/css/styles.css" rel="stylesheet" type="text/css" />

    <title></title>
    
    <link rel="shortcut icon" type="image/x-icon" href='https://developer.blackboard.com/assets/portal/favicon.ico'>
    <script>
        /* Set the width of the side navigation to 250px */
        function openNav() {
            document.getElementById("mySidenav").style.width = "500px";
            document.getElementById("main").style.marginLeft = "500px";
            document.body.style.backgroundColor = "rgba(0,0,0,0.4)";
        }

        /* Set the width of the side navigation to 0 */
        function closeNav() {
            document.getElementById("mySidenav").style.width = "0";
            document.getElementById("main").style.marginLeft = "0";
            document.body.style.backgroundColor = "white";
        }
    </script>
    <script>
      /* Loop through all dropdown buttons to toggle between hiding and showing its dropdown content - This allows the user to have multiple dropdowns without any conflict */
      var dropdown = document.getElementsByClassName("dropdown-btn");
      var i;
      
      for (i = 0; i < dropdown.length; i++) {
        dropdown[i].addEventListener("click", function() {
        this.classList.toggle("active");
        var dropdownContent = this.nextElementSibling;
        if (dropdownContent.style.display === "block") {
        dropdownContent.style.display = "none";
        } else {
        dropdownContent.style.display = "block";
        }
        });
      }
    </script>
    <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" />
    <!-- Begin Jekyll SEO tag v2.6.1 -->
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="http://localhost:4000/learn/B2s/Event%20Driven%20API.html" />
<meta property="og:url" content="http://localhost:4000/learn/B2s/Event%20Driven%20API.html" />
<script type="application/ld+json">
{"@type":"WebPage","url":"http://localhost:4000/learn/B2s/Event%20Driven%20API.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>
  <body>
    <div id='top-content'>
    <div id="header" class='header-min-width'>
        <div id="header-logos">
            <div id="header-logos-left-container" class='inline-box'>
                <a id="bb-home-logo-link" href="http://www.blackboard.com" target="_blank"><img class="bb-home-logo-image" src="https://developer.blackboard.com/assets/images/bb_logo_subpages.png" alt="Blackboard"/></a>
            </div>
            <div id="header-logos-right-container" class='inline-box'>
                
                    <a href="Contact.html" class="header-section-link">Contact Us</a>
                
                    <a href="https://community.blackboard.com/developers" class="header-section-link">Community</a>
                
                    <a href="https://developer.blackboard.com" class="header-section-link">Developer Portal</a>
                
                    <a href="BECOME%20AN%20OFFICIAL%20BLACKBOARD%20PARTNER!.html" class="header-section-link">Become a Partner</a>
                
                    <a href="/Get%20Involved.html" class="header-section-link">Get Involved</a>
                
            </div>
            <br class="clearBoth"/>
        </div>
            
        <br />
        <div class="wrap">
            <div id="subhead-section" class="subhead-icon-header-interaction">
                <h1 style="color: white;">Developer Documentation</h1>
            </div>
        </div>
    </div>
</div>
    <nav style='background-color: black;'>
  
    <a href="/" class="header-section-link">Home</a>
  
    <a href="/learn/Integrate%20with%20Blackboard%20Learn.html" class="header-section-link">Learn</a>
  
    <a href="/collab/Getting%20Started%20With%20The%20Blackboard%20Collaborate%20REST%20APIs.html" class="header-section-link">Collab</a>
  
    <a href="/connecttxt/Blackboard%20ConnectTxt%20Developer%20Documentation.html" class="header-section-link">ConnectTxt</a>
  
    <a href="/mobile/Blackboard%20App%20for%20Students%20Launch%20Schema.html" class="header-section-link">Mobile</a>
  
    <a href="/openlms/Blackboard%20Open%20LMS%20Approved%20Plugin%20Program%20(MAP).html" class="header-section-link">OpenLMS</a>
  
    <a href="/dvba/What%20is%20a%20DVBA%3F.html" class="header-section-link">DVBA</a>
  
    <a href="/standards/Welcome%20To%20Standards.html" class="header-section-link">Standards</a>
  
</nav>
    <section>
      <div id="mySidenav" class="sidenav">
    <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a><br>
    
        <ul>
            
                    <li><a href="/learn/Integrate%20with%20Blackboard%20Learn.html" class="header-section-link" >Learn</a></li>
                    
            
                    <li><a href="/learn/REST/Getting%20Started%20With%20REST.html" class="header-section-link" >REST</a></li>
                    
            
                    <li><a href="/learn/B2s/Getting%20Started%20With%20Building%20Blocks.html" class="header-section-link" >B2s</a></li>
                    
                        <ul>
                            
                                <li><a href="/learn/B2s/Getting%20Started%20With%20Building%20Blocks.html" class="header-section-link" >Getting Started</a></li>
                                
                            
                                <li><a href="/learn/B2s/Blackboard%20Building%20Blocks.html" class="header-section-link" >About</a></li>
                                
                            
                                <li><a href="/learn/B2s/advanced.html" class="header-section-link" >Advanced</a></li>
                                
                                    <ul>
                                        
                                            <li><a href="/learn/B2s/Building%20Blocks%20and%20Java%20Permissions.html" class="header-section-link" >Permission Errors</a></li>
                                        
                                            <li><a href="/learn/B2s/Dynamic%20Rendering%20with%20Template%20Variables.html" class="header-section-link" >Template Variables</a></li>
                                        
                                            <li><a href="/learn/B2s/Event%20Driven%20API.html" class="header-section-link" >Event-Driven API</a></li>
                                        
                                            <li><a href="/learn/B2s/Starter%20Building%20Block%20Readme.html" class="header-section-link" >Starting Block</a></li>
                                        
                                    </ul>
                                
                            
                                <li><a href="/learn/B2s/Building%20Block%20Resources%20and%20Tools.html" class="header-section-link" >Resources</a></li>
                                
                            
                                <li><a href="/learn/B2s/Preparing%20Your%20Building%20Blocks%20For%20Learn%20SaaS%20and%20Newer%20Learn%20Versions.html" class="header-section-link" >Best Practices</a></li>
                                
                            
                                <li><a href="/learn/B2s/Introduction%20to%20OpenDB.html" class="header-section-link" >OpenDb</a></li>
                                
                            
                                <li><a href="/learn/B2s/Examples%20-%20Building%20Blocks.html" class="header-section-link" >Examples</a></li>
                                
                            
                        </ul>
                
            
                    <li><a href="/learn/SOAP%20-%20Deprecated/SOAP-to-REST%20Migration%20Mapping.html" class="header-section-link" >SOAP - Deprecated</a></li>
                    
            
        </ul>
    
        
</div>
      
<!-- Add all page content inside this div if you want the side nav to push page content to the right (not used if you only want the sidenav to sit on top of the page -->
<div id="main">
    <!-- Use any element to open the sidenav -->
    <span style="font-size:30px;cursor:pointer" onclick="openNav()">&#9776;</span>

    <h1 id="event-driven-api">Event Driven API</h1>
<p><em>Author: Kelley MacEwen</em><br />
<em>Categories: []</em><br />
<em>Tags: [‘developer’]</em></p>
<hr />

<p>The Blackboard Learn Event Driven API is used to programmatically push the
following data into the Blackboard Learn database from an external system:</p>

<ul>
  <li>User</li>
  <li>Course</li>
  <li>Organization</li>
  <li>Enrollment</li>
  <li>Staff Student</li>
  <li>Organization membership</li>
  <li>Course and Organization category</li>
  <li>Course and Organization category membership</li>
</ul>

<p>The collaboration between the entity and the persistence classes is the
process by which data is obtained from the institution systems. An instance is
created for that data, and input into the Blackboard Learn database as a data
record.</p>

<p>The intended audience includes developers creating data integration solutions
for the Blackboard Learn. The Data Integration API Specifications describe the
packages, classes, and objects of the Event Driven API in systemlib/cms-
admin.jar.</p>

<h1 id="event-driven-api-architecture">Event Driven API architecture</h1>

<p>The API is a collection of java classes and objects that move data from the
institution systems into Blackboard Learn. Concrete data from the institution
systems are encapsulated as java objects. The methods contained in the java
classes determine how the data is input into Blackboard Learn. The data input
is controlled by persisters that process the appropriate method, convert the
object into data that can be input into Blackboard Learn database, and then
input that data according to the method called.</p>

<h2 id="entities-and-persisters">Entities and persisters</h2>

<p>There are two main types of objects in the API: entities (objects) and
persisters (actions). Entities include the objects that represent data in the
system, such as users. Persisters are behind-the-scenes methods that handle
the storage of the entities into a persistent store or transient data format.</p>

<h2 id="operations">Operations</h2>

<p>All data classes have methods to handle persistence actions. The following
persistence operations are supported:</p>

<ul>
  <li><em>Insert</em>: Inserts a record into the Blackboard Learn database.</li>
  <li><em>Update</em>: Updates an existing record in the Blackboard Learn database.</li>
  <li><em>Save</em>: Updates an existing record if it already exists. Otherwise, if it does not exist, inserts the record in the Blackboard Learn database.</li>
  <li><em>Remove</em>: Purges the record from the Blackboard Learn database.</li>
  <li><em>Change Key</em>: (Person and Group, Course, and Organization) Changes the primary key. This will automatically update any related Memberships of the changed keys.</li>
</ul>

<h2 id="create-an-object">Create an object</h2>

<p>To create an object in the system, instantiate a corresponding entity, set
attributes on the object, and then call a persister method (insert, update,
save, delete).</p>

<h2 id="persisters">Persisters</h2>

<p>The following Persisters are found in the Event Driven API:</p>

<ul>
  <li>CourseSitePersister</li>
  <li>OrganizationPersister</li>
  <li>EnrollmentPersister</li>
  <li>OrganizationMembershipPersister</li>
  <li>StaffStudentPersister</li>
  <li>PersonPersister</li>
  <li>CourseCategoryPersister</li>
  <li>OrganizationCategoryPersister</li>
  <li>CourseCategoryMembershipPersister</li>
  <li>OrganizationCategoryMembershipPersister</li>
  <li>PortalRolePersister</li>
</ul>

<p>Persist methods include changeKey, insert, remove, save, update, clone. Change
key is not relevant for membership type items. Clone is only relevant for
Coursesite/Organization. More information about Persist methods can be found
in the API specifications.</p>

<h2 id="loaders">Loaders</h2>

<p>The following Loaders are found in the Event Driven API:</p>

<ul>
  <li>SourseSiteLoader</li>
  <li>OrganizationLoader</li>
  <li>EnrollmentLoader</li>
  <li>OrganizationMembershipLoader</li>
  <li>StaffStudentLoader</li>
  <li>PersonLoader</li>
  <li>CourseCategoryLoader</li>
  <li>OrganizationCategoryLoader</li>
  <li>CourseCategoryMembershipLoader</li>
  <li>OrganizationCategoryMembershipLoader</li>
  <li>PortalRoleLoader</li>
</ul>

<p>Load methods include load by batch_uid and load by template. More information
about Load methods can be found in the API specifications.</p>

<h2 id="data-source-loader-and-persister">Data source loader and persister</h2>

<p>The following Data Source Loader and Persister are found in the Event Driven
API:</p>

<p><strong>DataSourceLoader</strong></p>

<ul>
  <li>loadAll()</li>
  <li>loadAdminObjectCount()</li>
  <li>loadAllAdminObjectCounts()</li>
  <li>loadByBatchUid()</li>
  <li>DataSourcePersister</li>
  <li>create()</li>
  <li>disableAdminObjectsByDataType()</li>
  <li>disableAllAdminObjects()</li>
  <li>modify()</li>
  <li>purgeAdminObjectsByDataType()</li>
  <li>purgeAllAdmiObjects()</li>
  <li>purgeSnapshotSessions()</li>
  <li>removeByBatchUid()</li>
</ul>

<h1 id="persistence-package">Persistence package</h1>

<p>For the most complete and up-to-date information about packages and classes,
refer to the Javadocs included with the API.</p>

<h2 id="persistence-package-1">Persistence package</h2>

<p>The persistence package provides a framework to handle the insert, update,
save, and delete for the entity objects. The framework includes:</p>

<ul>
  <li>BbServiceManage: This class handles the coordination of Blackboard Learn enabled services.</li>
  <li>PersistenceService: This class is a singleton, an object only intended to exist once, that manages the different persistence context for the entity objects.</li>
  <li>DbPersistenceManager: This class maintains the reference points for each individual loader/persister. An instance of any persister/loader is requested through it.</li>
  <li>PersisterInterfaces: This includes the PersonPersister, CoursesitePersister, and so forth.</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>blackboard.platform.BbServiceManager.init( serviceConfig,bbprops );

blackboard.platform.persistence.PersistenceService pService =
BbServiceManager.getPersistenceService().

blackboard.persist.BbPersistenceManager bManager =
pService.getDbPersistenceManager()

CoursesiteLoader cLoader=
(CoursesiteLoader)bManager.getLoader(CoursesiteLoader.TYPE);

PersistenceManager.getLoader=PersonPersister.Default.getInstance()
</code></pre></div></div>

<p>The user must initialize the BbServiceManager before attempting any
persistence of the admin data objects. After BbServiceManager is initialized
the appropriate loader/persister must be used according to the data type the
programmer intends to manage.</p>

<h1 id="determining-relationships">Determining relationships</h1>

<p>When using the API, there are specific steps than need to be followed to
determine the relationships between the entity and the persistence classes.</p>

<p>The following is an example of how to get a Course site:</p>

<p>blackboard.admin.data.course.CourseSite site=new</p>

<p>blackboard.admin.data.course.CourseSite();</p>

<ol>
  <li>The program must first initialize the BbServiceManager object. The method call is blackboard.platform.BbServiceManager.init( serviceConfig ); where serviceConfig is a java.io.File object. This object represents a link to the configuration file on the operating system. The file is a detailed list of all services that are active on the instance of the servicemanager as well as any of their configuration files.</li>
  <li>
    <p>The BbServiceManager object is only initialized once for each execution of the application.</p>
  </li>
  <li>
    <p>A virtual host is also needed for proper setup. A virtual host can be obtained by first getting the Virtual Installation Manager using BBServiceManager.lookupService(VirtualInstallationManager.class). The Virtual Installation Manager has a getVirtualHost(String id) method which returns the virtual host.</p>
  </li>
  <li>
    <p>Next, the ContextManager must be retrieved using BBServiceManager.lookupService(ContextManager.class). Finally, the context can be set by calling the ContextManager’s setContext() method and passing in the virtual host as an argument.</p>
  </li>
  <li>The following code sample assumes a “SERVICE_CONFIG_DIR” and “VIRTUAL_HOST_KEY” properties will be set, probably through –D parameters if it is used in a command line application. The SERVICE_CONFIG_DIR should be set to the full path of the Blackboard config directory, while the VIRTUAL_HOST_KEY needs to be the virtual installation you want to test, by default it is bb_bb60.</li>
</ol>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// Initialize the BbServiceManager and set the context

Follow the steps below to determine the relationships between the entity and
persistence classes.

try

{

blackboard.platform.BbServiceManager.init(System.getProperties().getProperty("
SERVICE_CONFIG_DIR") + "service-config-snapshot-jdbc.properties");

// The virtual host is needed to establish the proper database context.

VirtualInstallationManager vm = (VirtualInstallationManager)

BbServiceManager.lookupService(VirtualInstallationManager.class);

String vhostUID = System.getProperty("VIRTUAL_HOST_KEY", "bb_bb60");

VirtualHost vhost = vm.getVirtualHost(vhostUID);

vhost = vm.getVirtualHost(vhostUID);

if(vhost == null)

{

throw new Exception("Virtual Host '" + vhostUID + "' not found.");

}

// Now that the vhost is set we can set the context based on that vhost

ContextManager cm = (ContextManager)
BbServiceManager.lookupService(ContextManager.class);

Context context = cm.setContext(vhost);

}

catch(Exception e)

{

System.out.println("Exception trying to init the BbPersistenceManager\n " +
e.toString() + "..exiting.\n");

System.exit(0);

}
</code></pre></div></div>

<ol>
  <li>The controller creates an entity object and sets its attributes.</li>
  <li>The controller requests a persist action off the Loader / Persister.
```
CourseSiteLoader cLoader=</li>
</ol>

<p>(CourseSiteLoader)BbServiceManager.getPersistenceService().getDbPersistenceMan
ager().getLoader(CourseSiteLoader.TYPE);</p>

<p>CourseSitePersister cPersister=</p>

<p>(CourseSitePersister)BbServiceManager.getPersistenceService().getDbPersistence
Manager().getPersister(CoursesSitePersister.TYPE);</p>

<p>PersistenceManager.getLoader=PersonPersister.Default.getInstance()
```</p>

<ol>
  <li>The controller catches any persistence exceptions that occur.</li>
</ol>

<p>Repeat steps 2, 3, and 4 as needed for different entities and different
persist actions.</p>


</div>
    </section>
  </body>
</html>