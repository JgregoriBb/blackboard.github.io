I"þ<h1 id="building-block-security">Building Block Security</h1>
<p><em>Author: Kelley MacEwen</em><br />
<em>Categories: [â€˜Building Blocksâ€™, â€˜Tutorialsâ€™]</em><br />
<em>Tags: [â€˜developâ€™, â€˜best practiceâ€™, â€˜b2â€™, â€˜building blocksâ€™, â€˜migrated from edugarageâ€™, â€˜authenticationâ€™, â€˜entitlementsâ€™, â€˜developerâ€™]</em></p>
<hr />

<p>This page describes how to restrict access to a page in your building block.</p>

<h1 id="entitlements">Entitlements</h1>

<p>The primary means of restricting access to a building block is through the use
of entitlements. These intitlements are simply strings with the form
<strong>functional-area.ACTION</strong></p>

<p>For example,</p>

<ul>
  <li>The <strong>course.enrollment.MODIFY</strong> entitlement grants a user rights to modify an enrollment in a course.</li>
  <li>The <strong>course.assessment.results.VIEW</strong> entitlement grants a user rights to view results in a course.</li>
  <li>The <strong>course.content.CREATE</strong> entitlement grants a user rights to create content in a course.</li>
</ul>

<p>The list of available entitlements can be seen by looking at the
bb_bb60.entitlement table.</p>

<p>Every role in Blackboard has a set of entitlements attached to it. All the
entitlements for particular roles can be viewed and modified on the Privileges
page in the System Admin panel. However, for development purposes, itâ€™s easier
to look directly in the database.</p>

<h1 id="enforcing-entitlements">Enforcing entitlements</h1>

<p>The easiest way to check entitlements is by using the static methods on the
<a href="https:////library.blackboard.com/ref/15c9ac3f-f10f-44bc-91f9-1556e05cc5b6/blackboard/platform/security/SecurityUtil.html">SecurityUtil</a> class.</p>

<p>For example, to check whether a user has rights to modify an enrollment in a
course, you could write.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>if(SecurityUtil.userHasEntitlement("course.enrollment.MODIFY")) {
  ...
  ...
}
</code></pre></div></div>

<p>If you wish to check a set of permissions in one go, you can use the method <a href="https://library.blackboard.com/ref/15c9ac3f-f10f-44bc-91f9-1556e05cc5b6/blackboard/platform/security/SecurityUtil.html%23userHasAllEntitlements%28java.lang.String%5B%5D%29">SecurityUtil.userHasAllEntitlements(java.lang.String[])</a></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>if (SecurityUtil.userHasAllEntitlements(new String[]{"course.assessment.results.DELETE",
  "course.assessment.results.MODIFY", "course.assessment.results.VIEW"})) {
  ...
  ...
}
</code></pre></div></div>

<p><strong>The PlugInUtil class also has several methods you can use to check permissions, such as PlugInUtil.authorizeForCourseControlPanel(request, response). However, these methods will also generate a redirect to the front page if the check fails, which may interfere with your application logic.</strong></p>

<h1 id="ensuring-that-a-user-is-authenticated">Ensuring that a user is authenticated</h1>

<p>To check that a user is authenticated, you can call the isAuthenticated()
method on the userâ€™s <a href="https://library.blackboard.com/ref/15c9ac3f-f10f-44bc-91f9-1556e05cc5b6/blackboard/platform/session/BbSession.html">BbSession</a> object.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>BbSession bbSession = BbSessionManagerServiceFactory.getInstance().getSession(ctx.getActionBeanContext().getRequest());

if (!bbSession.isAuthenticated()) {
  .... REDIRECT THE USER TO THE LOGIN PAGE ....
}
</code></pre></div></div>

<p>If this code is in a JSP, you can redirect the user by calling
<code class="highlighter-rouge">HttpAuthManager.sendLoginRedirect(request,response)</code></p>

<p>JSP example:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>BbSession bbSession = BbSessionManagerServiceFactory.getInstance().getSession(
ctx.getActionBeanContext().getRequest());

if (! bbSession.isAuthenticated())
{
  HttpAuthManager.sendLoginRedirect(request,response);
  return;
}
</code></pre></div></div>

<p>However, if you are using a framework like
<a href="https://www.springsource.org/">Spring</a> or
<a href="https://www.stripesframework.org/">Stripes</a> calling
<code class="highlighter-rouge">HttpAuthManager.sendLoginRedirect</code> may interfere with your application logic,
and you may wish to just redirect to the root of your blackboard install.</p>

<p>Stripes example:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>BbSession bbSession = BbSessionManagerServiceFactory.getInstance().getSession(ctx.getActionBeanContext().getRequest());

if (! bbSession.isAuthenticated())
{
  return new RedirectResolution("/", false);
}
</code></pre></div></div>
:ET