I"<h1 id="building-blocks-and-java-permissions">Building Blocks and Java Permissions</h1>
<p><em>Author: Scott Hurrey</em><br />
<em>Categories: [‘Building Blocks’, ‘Tutorials’]</em><br />
<em>Tags: [‘building blocks’, ‘blackboard learn’, ‘permissions’, ‘bb-manifest.xml’, ‘developer’]</em></p>
<hr />

<p>Building Blocks are basically web applications which run in the Blackboard
Learn web application container. As such they require specific permissions
added to their bb-manifest.xml file to properly install, display, retrieve and
persist data, and correctly operate within the Learn application and
environment.</p>

<p>In order to interact with the Learn environment a Building Block must supply
the necessary set of java permissions in the permissions element located near
the bottom of the bb-manifest file. A basic set of permissions may include:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    &lt;permission type="attribute" name="user.personalinfo" actions="get,set"/&gt;   
    &lt;permission type="blackboard.persist.PersistPermission" name="user" actions="create,modify"/&gt;   
    &lt;permission type="java.net.SocketPermission" name="*" actions="resolve,connect"/&gt;   
    &lt;permission type="java.util.PropertyPermission" name="*" actions="read,write"/&gt;
</code></pre></div></div>
<p>One permission often seen is:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    &lt;permission type="java.io.FilePermission" name="&amp;lt;&amp;lt;ALL FILES&amp;gt;&amp;gt;" actions="read,write"/&gt;
</code></pre></div></div>

<p>While convenient to use this particular ‘wild card’ notation, it provides
access to all system files. Thus it is more secure to specify files and paths
directly even if this requires multiple permission entries:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    &lt;permission type="java.io.FilePermission" name="BB_HOME/logs/my_b2.log" actions="read,write"/&gt;
</code></pre></div></div>
<p>A more comprehensive though not all-inclusive set of permissions is listed at
the end of this help topic.</p>

<h3 id="how-do-i-know-which-permissions-to-include">How do I know which permissions to include?</h3>

<p>Unfortunately <strong><em>AccessControlException&lt;</em></strong> are not discoverable at compile-
time as they only manifest when a Building Block is running. So beyond the
common permissions noted above, exceptions may be determined by coding
practices or by log entry identification. When an installed Building Block
encounters a permissions gap at runtime it will throw an
<strong><em>AccessControlException</em></strong> permission error. You may use this error to
determine the exact permission you need to add to the bb-manifest to correct
the <strong><em>AccessControlException</em></strong> condition.</p>

<p>The main indication of an <strong><em>AccessControlException</em></strong> is receiving error 404
when launching your Building Block. This 404 error indicates that the resource
is unavailable. This 404 error is a good indication that the Building Block is
missing a required permission. The next step is to identify the missing
permission.</p>

<p>Using Linux as an example, inspect the
/usr/local/blackboard/logs/tomcat/stdout-stderr-xxxxxxxx-log.txt, where
xxxxxxxx is the date when the error appeared. Search this log for
<strong><em>AccessControlException</em></strong> and you should find something like this:</p>

<p>Caused by: java.security.<strong><em>AccessControlException</em></strong>: access denied
(java.net.SocketPermission tup6.temple.edu resolve)</p>

<p>This is the logged exception and follows the pattern of:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Caused by: java.security.**_AccessControlException_**: access denied (&lt;type&gt; &lt;name&gt; [&lt;actions&gt;])
</code></pre></div></div>

<p>To resolve this error, you simply need to add a new permission element to your
bb-manifest.xml file using the logged <type> <name> and if specified
[<actions>].</actions></name></type></p>

<p>The format for the permission element is (notice the same terminology in use):</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    &lt;permission type="&lt;type&gt;" name="&lt;name&gt;" actions="&lt;actions&gt;" /&gt;
</code></pre></div></div>

<p>Simply enter the values from the error message into the permission element,
add it to your bb-manifest and re-deploy your Building Block. It is important
to note that <actions> is optional. If your error stack doesn’t have <actions>
associated with it, simply leave it blank (i.e. actions="").</actions></actions></p>

<p>To illustrate this, we’ll take the above listed error and convert it into a
permission element.</p>

<p>Thus:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Caused by: java.security.**_AccessControlException_**: access denied
(java.net.SocketPermission tup6.temple.edu resolve)
</code></pre></div></div>

<p>Becomes:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    &lt;permission type=”java.net.SocketPermission” name=”tup6.temple.edu” actions=”resolve” /&gt;
</code></pre></div></div>

<p>You will need to re-deploy your Building Block after changing your bb-
manifest. Uninstalling and re-deploying your Building Block or changing the
version number will update the Building Block with the permissions specified
in the bb-manifest. In addition, Blackboard Learn 9.1 October 2014 Release
requires a system restart in order to implement the new changes in
permissions.</p>

<h2 id="more-permissions">More Permissions</h2>

<p>Below are some additional permissions for formatting reference.</p>

<p>Do not include more permissions than are necessary for proper operation of
your Building Block as this will impact start times.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    &lt;permission type="blackboard.data.AttributePermission" name="sessionmanager" actions="get" /&gt;  
    &lt;permission type="attribute" name="user.personalinfo" actions="get,set" /&gt;   
    &lt;permission type="persist" name="groupmembership" actions="create" /&gt;   
    &lt;permission type="attribute" name="user.authinfo" actions="get" /&gt;   
    &lt;permission type="java.util.PropertyPermission" name="*" actions="read,write" /&gt;    
    &lt;permission type="persist" name="content" actions="persist" /&gt;   
    &lt;permission type="persist" name="course" actions="create,modify,delete" /&gt;    
    &lt;permission type="persist" name="user" actions="create,modify,delete" /&gt;   
    &lt;permission type="persist" name="userrole" actions="create,modify,delete" /&gt;   
    &lt;permission type="persist" name="coursemembership" actions="persist,create,modify,delete" /&gt;                
    &lt;permission type="persist" name="enrollment" actions="persist,create,modify,delete" /&gt;   
    &lt;permission type="attribute" name="enrollment.rowstatus" actions="get,set" /&gt;                
    &lt;!-- Minimum permissions to support Spring --&gt;   
    &lt;permission type="java.lang.reflect.ReflectPermission" name="suppressAccessChecks" /&gt;   
    &lt;permission type="java.lang.RuntimePermission" name="accessDeclaredMembers" /&gt;   
    &lt;permission type="java.lang.RuntimePermission" name="createClassLoader" /&gt;   
    &lt;permission type="java.lang.RuntimePermission" name="setContextClassLoader" /&gt;                
    &lt;!--  For logback logging --&gt;   
    &lt;permission type="java.io.FilePermission" name="${java.home}/lib/*" actions="read" /&gt;  
    &lt;permission type="java.io.FilePermission" name="BB_HOME/logs/-" actions="read,write" /&gt;
</code></pre></div></div>
:ET